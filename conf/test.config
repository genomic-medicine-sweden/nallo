/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Nextflow config file for running minimal tests
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Defines input files and everything required to run a fast and simple pipeline test.

    Use as follows:
        nextflow run genomic-medicine-sweden/nallo -profile test,<docker/singularity> --outdir <OUTDIR>

----------------------------------------------------------------------------------------
*/
params {
    config_profile_name        = 'Test profile'
    config_profile_description = 'Minimal test dataset to check pipeline function'

    // Limit resources so that this can run on GitHub Actions
    max_cpus   = 4
    max_memory = '15.GB'
    max_time   = '6.h'

    // References
    fasta                    = params.pipelines_testdata_base_path + 'nallo/reference/hg38.test.fa.gz'
    input                    = 'https://github.com/genomic-medicine-sweden/test-datasets/raw/2948776ddf24ea131f527aa1f2dc23a43bb7b952/testdata/samplesheet.csv'
    bed                      = params.pipelines_testdata_base_path + 'nallo/reference/test_data.bed'
    hificnv_xy               = params.pipelines_testdata_base_path + 'nallo/reference/expected_cn.hg38.XY.bed'
    hificnv_xx               = params.pipelines_testdata_base_path + 'nallo/reference/expected_cn.hg38.XX.bed'
    hificnv_exclude          = params.pipelines_testdata_base_path + 'nallo/reference/empty.bed'
    par_regions              = params.pipelines_testdata_base_path + 'nallo/reference/hs38.PAR.bed'
    trgt_repeats             = params.pipelines_testdata_base_path + 'nallo/reference/pathogenic_repeats.hg38.bed'
    variant_catalog          = params.pipelines_testdata_base_path + 'nallo/reference/variant_catalog_grch38.json'
    vep_cache                = params.pipelines_testdata_base_path + 'nallo/reference/vep_cache_test_data.tar.gz'
    vep_plugin_files         = params.pipelines_testdata_base_path + 'nallo/reference/vep_plugin_files.csv'
    snp_db                   = params.pipelines_testdata_base_path + 'nallo/testdata/snp_dbs.csv'
    reduced_penetrance       = params.pipelines_testdata_base_path + 'nallo/reference/reduced_penetrance.tsv'
    score_config_snv         = params.pipelines_testdata_base_path + 'nallo/reference/rank_model_snv.ini'
    variant_consequences_snv = params.pipelines_testdata_base_path + 'nallo/reference/variant_consequences_v2.txt'
    somalier_sites           = params.pipelines_testdata_base_path + 'nallo/reference/somalier_sites.vcf.gz'

    // Pipeline options
    parallel_snv = 2
    preset       = "revio"

    // Test config options
    extra_modkit_phased_options   = '--seed 1 --sampling-frac 0.1'
    extra_modkit_unphased_options = '--seed 1 --sampling-frac 0.1'
    extra_vep_options             = '--plugin SpliceAI,snv=spliceai_21_scores_raw_snv_-v1.3-.vcf.gz,indel=spliceai_21_scores_raw_snv_-v1.3-.vcf.gz'
    extra_paraphase_options       = '--gene hba'
    extra_hifiasm_options         = '-f0 -k30 -w30 -D10 -r1 -N1'
}

process {

    withLabel: 'process_high' {
        cpus = 4
    }

    withLabel: 'process_medium' {
        cpus = 2
    }

    withLabel: 'process_low' {
        cpus = 1
    }

    withLabel: 'process_single' {
        cpus = 1
    }

}
